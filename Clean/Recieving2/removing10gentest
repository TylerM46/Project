import numpy as np
from PIL import Image

readdata = "11001010101010101010110010010010111001101110101001001011001001110000101010010001011000100100101001001001001011010010011000100100101001001001001010010011011000100100101001001001001010010010011000100010011000101101101011011011011010100100111000101001001011011011011010111000101001101101001010011100101011011101101011010110111001011011101000000010011000000100101000001001001010100100001000100100001001001001001010010100101001000100101001000000001010010100101001001101101001001001011000100100111001101101001010010001001010100010101001001001101011010011011010010100101010010110111000101101011010110110101001101100001001001000001010010000011000100101001010000001001010000010011000100100101010010010001010010010011000100100101001001010011000100010011000100100101010011011101000110110111000101001001001010010001000010010101001101101101011011010011010110100101001001101111000011011101000010100101000101001001001010010011000100100011001001001001010010010011000100110111001101001001010010011011010100110111001101101101001001001011000100100111010010010011000100011011011000111001010000100101010001010011001001001011001110010011001110101101001011010111001101100101010010001011000100010011000101001001010001010011000010010101000101001001010010011001010010010011000101000101010010010011010110010011000100100101001010010011000110111001000100101001010010010001010010100001000000101001010011100101001001101101011010010011001100100101000010010101000000100101001010010001010100100001000100100001001001001001010010100101001000100101001001001001010010010011001001001001000001001001010010010011000101010011000100010011000100010101001001001001011001010011000100100111010010010011010110110101001011011001010010001001011011001011000100010011000101001001010001001001010010010011000100101001010010011001010010100011000101000101001010001001010010010101001000101001010010010011001011001011001101101101011010011011010111000101001101101101011100100101001001101101011010010111001100100101000100100101001101110001001010010011000100100101001001000101010010001011000100100101001100101001010010010011000010100101000100100101001010010011000100100101001001010011000100011011011000100101001001001001011010010011010100110111010010001111010110110101011011011001010010000001001001001001010010110111001100100101001000001001010000010011000100100101010010010001000010010011000100100101001001001011000100010011000100100101001001001001011000111001001101101101010001010011000100100101001001101001010011011101000111101101011010010011000100100101000010010011000000000101001010010011010110110001000100100001001001000001000010100101001000100101001001001001010010010011001001001001001001010001010010100101000101010001011100100011011000100101001001001001011010010011010110111001001101101111010110110101011011011001010010000101001001001001010010010101000101101101011010010011000100100101001001001001011011011011000100110101001001000101001001011011010110110111001101101101011100011011011000111001010110010101011010011001010010100111001001110001011100011101000111011011010110010011001100100101010100100101000100100101001001001011000110110101001001000101010001001001010010100101001001001001010001001001010000010011001001001001010010010001010010010011000100101101011011010001010100010001000101000101010011010011010110100111001001001001001001001011010111000111001110001001010010001001010010000001000001001001010011011011010000000001000000000001010010010001010010010011000100100101001001010011000100100011001000100001001010001001010110100111001000101001010001001011000010101001001001101101001010001011000100000001000001001001010011011011010010010011001101101101001001001001010010010111001101100101001000001001010010100101001001001001010001001001010010010011001101001101011010010011000010100111000101010001011100100011010111000101001101101001011101100101000110100101000100101001000001001001010100101001010010001001010010011011010111001001010001101101011011011011011001000111010001101111001100100101011001000101000100101101011011101101011011101011010111010111001111101111001101011011011110110111011101110111011101101111011011011111001110010011000100000001000100100101010010001011000010010011001101101111001101101111001011011001001101111011001101111111001101111101011011011011010001001001011011001011011111111111011110111111011101111111011011111111010110111111001101111101011011111011010111110111001111101101000100101001000000001001010000010001000000100001000000000001000000110111001110010011000011011011011001000111010001101111000011011011010110110101000100101001001010011011000100110101001001101001010011001001010110010011001100100101011001001011010010011001000100101101000000001001010010000001000000000001000000000001000000000001000000000001010010001011000010010101001000101001010001001001000000010001000000100101000001001001010010000001000100000001001000000011000000000101000000001001000000011001000000110001000010000101001100001001011000010011000100100101001000001001000000000011000100100101000000001001010000110111001001000101001010010001010110100101001000100101010010001011000100010011000100101001001001011011000101000101001010001001010100010011001010100101010101001011010010010111000100111101001001111001011011000001000000010011000100100101001010001001010010010001001001000101011011010011010100100111001000110001011011100011010111000111001001101101010001001001000110100101010101101111001011011101010110111101001101111001011011110011010111100111001111001101011111011011011100100111000100100101001001001001010010000101000100001001010001011011010100100101000101101001010011010001011000110101001101001001011010010011010100100011000100001001010001100011000101000101001010001001010100010011001010100101010101001011001010010101010010101011001001011001010010001001000000110111001001101101010010010001010110110101001001000101010001000011000010010111001001001101010010010001010010110101000101001001001001001001000100010011001101000101011010001101000010011001000100110001001001100001010011000011000110000101001101001001011010010011010001101111001100100101000110111001001101001001010001001001010000100101000101000101001011010011000110100101001000100101010001001011000100010011000100101001001001010001010010110011000101100101001011001001010110010011010000100111000001001101000010011001000100110001001001101101011011011001010010001101011011010011000100010011001000100001010010001011000010010101001001001101010010010001010010100101000101001001001010001001010010010011001001000101011001001011010010010111000100101101001001011001010011000011000110000101001100001001011010110101010110010011000100011011010100100111001001001001001001010001010010010011000101000101001010010001010100100011001000100101010010001011000100010011000100100101001001010001010010110011000101100101001011001001000110010011010000100101011001001011010010011001000100110101001011001010101010101010110010010010111001101110101001001011001001110000101010010001011000100100101001001001001011010010011000100100101001001001001010010011011000100100101001001001001010010010011000100010011000101101101011011011011010100100111000101001001011011011011010111000101001101101001010011100101011011101101011010110111001011011101000000010011000000100101000001001001010100100001000100100001001001001001010010100101001000100101001000000001010010100101001001101101001001001011000100100111001101101001010010001001010100010101001001001101011010011011010010100101010010110111000101101011010110110101001101100001001001000001010010000011000100101001010000001001010000010011000100100101010010010001010010010011000100100101001001010011000100010011000100100101010011011101000110110111000101001001001010010001000010010101001101101101011011010011010110100101001001101111000011011101000010100101000101001001001010010011000100100011001001001001010010010011000100110111001101001001010010011011010100110111001101101101001001001011000100100111010010010011000100011011011000111001010000100101010001010011001001001011001110010011001110101101001011010111001101100101010010001011000100010011000101001001010001010011000010010101000101001001010010011001010010010011000101000101010010010011010110010011000100100101001010010011000110111001000100101001010010010001010010100001000000101001010011100101001001101101011010010011001100100101000010010101000000100101001010010001010100100001000100100001001001001001010010100101001000100101001001001001010010010011001001001001000001001001010010010011000101010011000100"

def binary_to_image(binary_string, width, height, channels):
    # Convert binary string to byte array
    byte_array = bytearray()
    for i in range(0, len(binary_string), 3):
        byte = binary_string[i:i+3]
        byte_array.append(int(byte, 2) * 32)  # Scale back to original color range

    # Convert byte array to numpy array
    img_array = np.array(byte_array, dtype=np.uint8).reshape((height, width, channels))

    # Create and save image
    img = Image.fromarray(img_array, mode='RGB')
    
    img.save('./alive.jpg')
    print("made it")

def extractdata(binary_string, pattern):
    positions = []   # array of instance positions 
    start = 0

    # Find all start positions of the pattern
    while True:
        idx = binary_string.find(pattern, start)
        if idx == -1:
            break
        positions.append(idx)
        start = idx + 1  # allow overlapping

    # Extract sequences between each pair of occurrences
    results = []
    for i in range(len(positions) - 1):
        start_idx = positions[i] + len(pattern)
        end_idx = positions[i + 1]
        results.append(binary_string[start_idx:end_idx])

    return results

def remove_separators(bin_str):
    cleaned = []
    i = 0
    length = len(bin_str)
    while i < length:
        # Take 10 bits of data
        if i + 10 > length:
            # If less than 10 bits remain, just append remainder and stop
            cleaned.append(bin_str[i:])
            break
        data_bits = bin_str[i:i+10]
        cleaned.append(data_bits)
        i += 10

        # Check next two bits are separator '10'
        if i + 2 <= length:
            sep = bin_str[i:i+2]
            if sep != "10":
                raise ValueError(f"Separator '10' expected at position {i}, found '{sep}'")
            i += 2
        else:
            # No more separator, likely end of string
            break

    return ''.join(cleaned)

# --- Main usage ---

pattern = "110010101010101010101100"
segments = extractdata(readdata, pattern)

print(segments, len(segments[0]))

# Remove separators from the first extracted segment
cleaned_segment = remove_separators(segments[0])

print(f"Length before removing separators: {len(segments[0])}")
print(f"Length after removing separators: {len(cleaned_segment)}")

width = 25 # Replace with actual width
height = 25  # Replace with actual height
channels = 3  # RGB

binary_to_image(cleaned_segment, width, height, channels)

print(len(cleaned_segment))
